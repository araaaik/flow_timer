<!DOCTYPE html>
<html>
<head>
    <title>Debug Flow App Storage</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .storage-item { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .key { font-weight: bold; color: #0066cc; }
        .value { margin-top: 5px; background: #f5f5f5; padding: 5px; }
        button { margin: 5px; padding: 5px 10px; }
        .clear-btn { background: #ff4444; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Flow App Storage Debug</h1>
    
    <div id="storage-content"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="clearActiveTask()" class="clear-btn">Clear Active Task</button>
        <button onclick="clearAllFlowData()" class="clear-btn">Clear All Flow Data</button>
        <button onclick="refresh()">Refresh</button>
    </div>

    <script>
        function displayStorage() {
            const container = document.getElementById('storage-content');
            container.innerHTML = '';
            
            const flowKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('flow-')) {
                    flowKeys.push(key);
                }
            }
            
            flowKeys.sort().forEach(key => {
                const value = localStorage.getItem(key);
                const div = document.createElement('div');
                div.className = 'storage-item';
                
                let displayValue = value;
                try {
                    const parsed = JSON.parse(value);
                    displayValue = JSON.stringify(parsed, null, 2);
                } catch (e) {
                    // Keep original value if not JSON
                }
                
                div.innerHTML = `
                    <div class="key">${key}</div>
                    <div class="value"><pre>${displayValue}</pre></div>
                `;
                container.appendChild(div);
            });
            
            if (flowKeys.length === 0) {
                container.innerHTML = '<p>No Flow app data found in localStorage</p>';
            }
        }
        
        function clearActiveTask() {
            localStorage.removeItem('flow-active-task');
            alert('Active task cleared!');
            displayStorage();
        }
        
        function clearAllFlowData() {
            if (confirm('Are you sure you want to clear ALL Flow app data?')) {
                const flowKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('flow-')) {
                        flowKeys.push(key);
                    }
                }
                
                flowKeys.forEach(key => localStorage.removeItem(key));
                alert('All Flow data cleared!');
                displayStorage();
            }
        }
        
        function refresh() {
            displayStorage();
        }
        
        // Initial load
        displayStorage();
    </script>
</body>
</html>